document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".form-data"),t=document.querySelector(".region-name"),o=document.querySelector(".api-key"),n=document.querySelector(".errors"),r=document.querySelector(".loading"),a=document.querySelector(".result-container"),l=document.querySelector(".carbon-usage"),s=document.querySelector(".fossil-fuel"),c=document.querySelector(".my-region"),i=document.querySelector(".clear-btn");function d(){const t=localStorage.getItem("apiKey"),o=localStorage.getItem("regionName");t&&o?(y(t,o),a.style.display="none",e.style.display="none",i.style.display="block"):(e.style.display="block",a.style.display="none",r.style.display="none",i.style.display="none",n.textContent="")}async function y(t,o){try{const n=`https://api.electricitymaps.com/v3/carbon-intensity/latest?countryCode=${o}`,i=await fetch(n,{method:"GET",headers:{"auth-token":t,"Content-Type":"application/json"}});if(!i.ok)throw new Error(`API request failed: ${i.status}`);const d=await i.json(),y=Math.round(d.carbonIntensity);!function(e){const t=[0,150,600,750,800],o=t.sort((t,o)=>Math.abs(t-e)-Math.abs(o-e))[0],n=["#2AA364","#F5EB4D","#9E4229","#381D02","#381D02"][t.findIndex(e=>e>o)];"undefined"!=typeof chrome&&chrome.runtime?.sendMessage?chrome.runtime.sendMessage({action:"updateIcon",value:{color:n}}):console.log(`Icon color (local mode): ${n}`)}(y),r.style.display="none",e.style.display="none",c.textContent=o.toUpperCase(),l.textContent=`${y} gCO₂/kWh`,void 0!==d.fossilFuelPercentage&&(s.textContent=`${d.fossilFuelPercentage.toFixed(2)}% fossil fuels`),a.style.display="block"}catch(e){console.error("Error fetching carbon data:",e),r.style.display="none",a.style.display="none",n.textContent="Sorry, we couldn’t fetch data for that region. Please check your API key and region code."}}e&&t&&o&&a&&r&&l&&c&&i?(e.addEventListener("submit",function(e){var a,l;e.preventDefault(),a=o.value,l=t.value,localStorage.setItem("apiKey",a),localStorage.setItem("regionName",l),r.style.display="block",n.textContent="",i.style.display="block",y(a,l)}),i.addEventListener("click",function(e){e.preventDefault(),localStorage.removeItem("regionName"),localStorage.removeItem("apiKey"),d()}),d()):console.error("❌ One or more elements are missing from the HTML structure.")});